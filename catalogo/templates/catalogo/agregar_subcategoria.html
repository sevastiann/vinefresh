<!-- 游 Modal Agregar Subcategor칤a -->
<div id="modalCategoria" class="modal-overlay">
    <div class="modal-content">
        <span class="cerrar-modal" id="cerrarModal">&times;</span>
        <h2>Agregar Subcategor칤a</h2>

        <form method="POST" action="{% url 'catalogo:agregar_subcategoria' %}">
            {% csrf_token %}

            <!-- Nivel 1: Secci칩n -->
            <div class="form-group">
                <label for="seccion">Secci칩n:</label>
                <select id="seccion" name="seccion" required>
                    <option value="">-- Selecciona una secci칩n --</option>
                    <option value="productos">Productos</option>
                    <option value="combos">Combos</option>
                </select>
            </div>

            <!-- Nivel 2: Categor칤a principal -->
            <div class="form-group" id="categoria-container" style="display:none;">
                <label for="categoria">Categor칤a principal:</label>
                <select id="categoria" name="categoria_principal"></select>
            </div>

            <!-- Nivel 3: Nueva subcategor칤a -->
            <div class="form-group">
                <label for="subcategoria">Nombre de la nueva subcategor칤a:</label>
                <input type="text" id="subcategoria" name="nombre" required>
            </div>

            <div class="botones-modal">
                <button type="submit" class="btn-guardar">Guardar</button>
                <button type="button" id="cerrarModal2" class="btn-cancelar">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- 丘뙖잺 Diccionario de categor칤as est치ticas -->
<script>
window.categoriasData = {
    productos: [
        ['dulzor', 'Dulzor'],
        ['grado_alcohol', 'Grado de alcohol'],
        ['pais_origen', 'Pa칤s de origen'],
        ['tipo_fruta', 'Tipo de fruta'],
        ['color', 'Color']
    ],
    combos: [
        ['festividad', 'Festividad'],
        ['temporada', 'Temporada'],
        ['ano_anejamiento', 'A침o de a침ejamiento']
    ]
};
</script>

<!-- 游꿛 Estilos -->
<style>
.modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
.modal-content {
    background: #fff;
    color: #333;
    padding: 20px 30px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    position: relative;
    animation: fadeIn 0.3s ease-in-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}
.cerrar-modal {
    position: absolute;
    top: 10px; right: 15px;
    cursor: pointer;
    font-size: 1.4em;
    color: #888;
}
.cerrar-modal:hover { color: #000; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
.form-group input, .form-group select {
    width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;
}
.botones-modal {
    display: flex; justify-content: flex-end; gap: 10px;
}
.btn-guardar {
    background: #3b2f2f; color: #fff; border: none;
    padding: 8px 12px; border-radius: 5px; cursor: pointer;
}
.btn-cancelar {
    background: #aaa; color: #fff; border: none;
    padding: 8px 12px; border-radius: 5px; cursor: pointer;
}
</style>

<!-- 丘뙖잺 Script -->
<script>
// static/js/modal_categoria.js
document.addEventListener("DOMContentLoaded", () => {

    // === Helpers para abrir/cerrar modales ===
    const openModal = modal => modal && (modal.style.display = 'flex');
    const closeModal = modal => modal && (modal.style.display = 'none');

    // === Modal Agregar ===
    const modalAgregar = document.getElementById("modalCategoria");
    const abrirAgregar = document.getElementById("abrirModal");
    const cerrarAgregar = document.getElementById("cerrarModal");
    const cerrarAgregar2 = document.getElementById("cerrarModal2");

    if (abrirAgregar && modalAgregar) {
        abrirAgregar.addEventListener('click', () => openModal(modalAgregar));
        if (cerrarAgregar) cerrarAgregar.addEventListener('click', () => closeModal(modalAgregar));
        if (cerrarAgregar2) cerrarAgregar2.addEventListener('click', () => closeModal(modalAgregar));
    }

    // === Cerrar si se hace clic fuera del modal ===
    window.addEventListener('click', e => {
        if (e.target === modalAgregar) closeModal(modalAgregar);
    });

    // === Diccionario de categor칤as est치ticas ===
    // (Debe declararse antes en el HTML como window.categoriasData)
    // Ejemplo:
    // window.categoriasData = {
    //   productos: [['dulzor', 'Dulzor'], ...],
    //   combos: [['festividad', 'Festividad'], ...]
    // };

    // === Funci칩n para llenar el select ===
    function populateCategoriaSelect(seccionValue, targetSelect) {
        if (!targetSelect) return;
        targetSelect.innerHTML = '';

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- Selecciona una categor칤a principal --';
        targetSelect.appendChild(defaultOption);

        const data = window.categoriasData?.[seccionValue];
        if (!data || data.length === 0) {
            const noOpt = document.createElement('option');
            noOpt.textContent = '(No hay categor칤as disponibles)';
            noOpt.disabled = true;
            targetSelect.appendChild(noOpt);
            return;
        }

        data.forEach(([value, label]) => {
            const opt = document.createElement('option');
            opt.value = value;
            opt.textContent = label;
            targetSelect.appendChild(opt);
        });
    }

    // === Conectar los selects del modal Agregar ===
    const seccionAgregar = document.getElementById('seccion');
    const categoriaAgregar = document.getElementById('categoria');
    const categoriaContainer = document.getElementById('categoria-container');

    if (seccionAgregar && categoriaAgregar) {
        seccionAgregar.addEventListener('change', () => {
            const val = seccionAgregar.value;
            if (!val) {
                categoriaContainer.style.display = 'none';
                return;
            }
            categoriaContainer.style.display = 'block';
            populateCategoriaSelect(val, categoriaAgregar);
        });
    }
});

</script>


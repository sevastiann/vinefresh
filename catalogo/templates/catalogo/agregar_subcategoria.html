<div id="modalCategoria" class="modal-overlay">
    <div class="modal-content">
        <span class="cerrar-modal" id="cerrarModal">&times;</span>
        <h2>Agregar Subcategor칤a</h2>

        <form method="POST" action="{% url 'catalogo:agregar_subcategoria' %}">
            {% csrf_token %}

            <!-- Nivel 1: Secci칩n -->
            <div class="form-group">
                <label for="seccion">Secci칩n:</label>
                <select id="seccion" name="seccion" required>
                    <option value="">-- Selecciona una secci칩n --</option>
                    <option value="productos">Productos</option>
                    <option value="combos">Combos</option>
                </select>
            </div>

            <!-- Nivel 2: Categor칤a principal -->
            <div class="form-group" id="categoria-container" style="display:none;">
                <label for="categoria">Categor칤a principal:</label>
                <select id="categoria" name="categoria_principal" required>
                    <option value="">-- Selecciona una categor칤a principal --</option>
                    {% comment %} Categor칤as de productos {% endcomment %}
                    <option value="dulzor" class="productos">Dulzor</option>
                    <option value="grado_alcohol" class="productos">Grado de alcohol</option>
                    <option value="pais_origen" class="productos">Pa칤s de origen</option>
                    <option value="tipo_fruta" class="productos">Tipo de fruta</option>
                    <option value="color" class="productos">Color</option>

                    {% comment %} Categor칤as de combos {% endcomment %}
                    <option value="festividad" class="combos">Festividad</option>
                    <option value="temporada" class="combos">Temporada</option>
                    <option value="ano_anejamiento" class="combos">A침o de a침ejamiento</option>
                </select>
            </div>

            <!-- Nivel 3: Nueva subcategor칤a -->
            <div class="form-group">
                <label for="subcategoria">Nombre de la nueva subcategor칤a:</label>
                <input type="text" id="subcategoria" name="nombre" required>
            </div>

            <div class="botones-modal">
                <button type="submit" class="btn-guardar">Guardar</button>
                <button type="button" id="cerrarModal2" class="btn-cancelar">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const modalAgregar = document.getElementById("modalCategoria");
    const abrirAgregar = document.getElementById("abrirModal");
    const cerrarAgregar = document.getElementById("cerrarModal");
    const cerrarAgregar2 = document.getElementById("cerrarModal2");

    const openModal = modal => modal && (modal.style.display = 'flex');
    const closeModal = modal => modal && (modal.style.display = 'none');

    if (abrirAgregar && modalAgregar) {
        abrirAgregar.addEventListener('click', () => openModal(modalAgregar));
        cerrarAgregar?.addEventListener('click', () => closeModal(modalAgregar));
        cerrarAgregar2?.addEventListener('click', () => closeModal(modalAgregar));
    }

    window.addEventListener('click', e => {
        if (e.target === modalAgregar) closeModal(modalAgregar);
    });

    // Filtrar categor칤as seg칰n la secci칩n seleccionada
    const seccion = document.getElementById('seccion');
    const categoria = document.getElementById('categoria');
    const contenedorCategoria = document.getElementById('categoria-container');

    seccion.addEventListener('change', () => {
        const val = seccion.value;
        if (!val) {
            contenedorCategoria.style.display = 'none';
            return;
        }
        contenedorCategoria.style.display = 'block';
        Array.from(categoria.options).forEach(opt => {
            opt.style.display = (opt.classList.contains(val) || opt.value === '') ? 'block' : 'none';
        });
        categoria.value = ''; // resetear selecci칩n
    });
});
</script>


<!-- 游꿛 Estilos -->
<style>
.modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
.modal-content {
    background: #fff;
    color: #333;
    padding: 20px 30px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    position: relative;
    animation: fadeIn 0.3s ease-in-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}
.cerrar-modal {
    position: absolute;
    top: 10px; right: 15px;
    cursor: pointer;
    font-size: 1.4em;
    color: #888;
}
.cerrar-modal:hover { color: #000; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
.form-group input, .form-group select {
    width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;
}
.botones-modal {
    display: flex; justify-content: flex-end; gap: 10px;
}
.btn-guardar {
    background: #3b2f2f; color: #fff; border: none;
    padding: 8px 12px; border-radius: 5px; cursor: pointer;
}
.btn-cancelar {
    background: #aaa; color: #fff; border: none;
    padding: 8px 12px; border-radius: 5px; cursor: pointer;
}
</style>



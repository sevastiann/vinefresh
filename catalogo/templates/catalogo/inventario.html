{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="layout-container">
<!-- ===========================
              üî∏ SIDEBAR
        ============================ -->
        <aside class="sidebar">

            <!-- üîç Buscador -->
            <div class="buscador mb-4">
                <input type="text" id="buscar" placeholder="Buscar por nombre..." class="input-buscar">
                <button class="btn-buscar">üîç</button>
            </div>

            <!-- üí∞ Filtro de precio -->
            <div class="filtro-precio mb-5">
                <label class="bloque-texto font-semibold mb-2">Filtrar por precio</label>
                <div class="precio-inputs">
                    <input type="number" id="precio_min" placeholder="M√≠nimo" class="input-precio">
                    <span>‚Äî</span>
                    <input type="number" id="precio_max" placeholder="M√°ximo" class="input-precio">
                </div>
            </div>

            <!-- üçá Filtros seg√∫n secci√≥n -->
            <div class="filtros-plegables">

                {% if seccion == "vinos" %}

                    <details open>
                        <summary>Pa√≠s</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="pais" value="Chile" id="pais1"><label for="pais1">Chile</label></li>
                            <li><input type="checkbox" name="pais" value="Argentina" id="pais2"><label for="pais2">Argentina</label></li>
                            <li><input type="checkbox" name="pais" value="Espa√±a" id="pais3"><label for="pais3">Espa√±a</label></li>
                            <li><input type="checkbox" name="pais" value="Italia" id="pais4"><label for="pais4">Italia</label></li>
                            <li><input type="checkbox" name="pais" value="Francia" id="pais5"><label for="pais5">Francia</label></li>
                            <li><input type="checkbox" name="pais" value="Colombia" id="pais6"><label for="pais6">Colombia</label></li>
                            <li><input type="checkbox" name="pais" value="M√©xico" id="pais7"><label for="pais7">M√©xico</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Color</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="color" value="Tinto" id="color1"><label for="color1">Tinto</label></li>
                            <li><input type="checkbox" name="color" value="Blanco" id="color2"><label for="color2">Blanco</label></li>
                            <li><input type="checkbox" name="color" value="Rosado" id="color3"><label for="color3">Rosado</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Grado de Alcohol</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="alcohol" value="Menos de 10%" id="alcohol1"><label for="alcohol1">Menos de 10%</label></li>
                            <li><input type="checkbox" name="alcohol" value="10% - 13%" id="alcohol2"><label for="alcohol2">10% - 13%</label></li>
                            <li><input type="checkbox" name="alcohol" value="M√°s de 13%" id="alcohol3"><label for="alcohol3">M√°s de 13%</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Tipo de Uva</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="uva" value="Cabernet Sauvignon" id="uva1"><label for="uva1">Cabernet Sauvignon</label></li>
                            <li><input type="checkbox" name="uva" value="Malbec" id="uva2"><label for="uva2">Malbec</label></li>
                            <li><input type="checkbox" name="uva" value="Merlot" id="uva3"><label for="uva3">Merlot</label></li>
                            <li><input type="checkbox" name="uva" value="Sauvignon Blanc" id="uva4"><label for="uva4">Sauvignon Blanc</label></li>
                            <li><input type="checkbox" name="uva" value="Verdejo" id="uva5"><label for="uva5">Verdejo</label></li>
                            <li><input type="checkbox" name="uva" value="Carm√©n√®re" id="uva6"><label for="uva6">Carm√©n√®re</label></li>
                            <li><input type="checkbox" name="uva" value="Nebbiolo" id="uva7"><label for="uva7">Nebbiolo</label></li>
                            <li><input type="checkbox" name="uva" value="Pinot Noir" id="uva8"><label for="uva8">Pinot Noir</label></li>
                            <li><input type="checkbox" name="uva" value="Grenache" id="uva9"><label for="uva9">Grenache</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Volumen</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="vol" value="375 ml" id="vol1"><label for="vol1">375 ml</label></li>
                            <li><input type="checkbox" name="vol" value="750 ml" id="vol2"><label for="vol2">750 ml</label></li>
                            <li><input type="checkbox" name="vol" value="1 L" id="vol3"><label for="vol3">1 L</label></li>
                        </ul>
                    </details>

                {% elif seccion == "combos" %}

                    <details open>
                        <summary>Festividad</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="fest" value="Navidad" id="fest1"><label for="fest1">Navidad</label></li>
                            <li><input type="checkbox" name="fest" value="A√±o Nuevo" id="fest2"><label for="fest2">A√±o Nuevo</label></li>
                            <li><input type="checkbox" name="fest" value="San Valent√≠n" id="fest3"><label for="fest3">San Valent√≠n</label></li>
                            <li><input type="checkbox" name="fest" value="D√≠a del Padre" id="fest4"><label for="fest4">D√≠a del Padre</label></li>
                            <li><input type="checkbox" name="fest" value="D√≠a de la Madre" id="fest5"><label for="fest5">D√≠a de la Madre</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Premium</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="prem" value="premium_gold" id="prem1"><label for="prem1">Gold</label></li>
                            <li><input type="checkbox" name="prem" value="premium_platinum" id="prem2"><label for="prem2">Platinum</label></li>
                            <li><input type="checkbox" name="prem" value="premium_black_label" id="prem3"><label for="prem3">Black Label</label></li>
                        </ul>
                    </details>

                    <details>
                        <summary>Regalo</summary>
                        <ul class="lista-filtro">
                            <li><input type="checkbox" name="reg" value="regalo_amistad" id="reg1"><label for="reg1">Amistad</label></li>
                            <li><input type="checkbox" name="reg" value="regalo_cumplea√±os" id="reg2"><label for="reg2">Cumplea√±os</label></li>
                            <li><input type="checkbox" name="reg" value="regalo_pareja" id="reg3"><label for="reg3">Pareja</label></li>
                            <li><input type="checkbox" name="reg" value="regalo_corporativo" id="reg4"><label for="reg4">Corporativo</label></li>
                        </ul>
                    </details>

                {% endif %}
            </div>
        </aside>
<!-- ===========================
              üî∏ CONTENIDO PRINCIPAL
        ============================ -->
        <main class="catalogo-contenido">

            <!-- Mini Navbar -->
            <div class="mini-navbar" align="center">
                <a href="{% url 'catalogo:productos' %}?seccion=vinos"
                   class="nav-item {% if seccion == 'vinos' %}activo{% endif %}">Vinos</a>

                <a href="{% url 'catalogo:productos' %}?seccion=combos"
                   class="nav-item {% if seccion == 'combos' %}activo{% endif %}">Combos</a>
            </div>


        <!-- üî∏ √Årea central -->
        <div class="productos-section">
           
            <!-- üî∏ Bot√≥n de agregar -->
            <div class="acciones-admin-superior">
                {% if seccion == 'vinos' %}
                    <a href="{% url 'catalogo:agregar_producto' %}" class="btn-agregar-producto">
                        ‚ûï Agregar Vino
                    </a>
                {% else %}
                    <a href="{% url 'catalogo:agregar_combo' %}" class="btn-agregar-producto">
                        ‚ûï Agregar Combo
                    </a>
                {% endif %}
            </div>

            <!-- üî∏ Grid de productos -->
             <div id="productos-container" data-filtrar-url="{% url 'catalogo:filtrar_inventarios' %}">
                    {% include "catalogo/inventarios_grid.html" %}
                <div class="productos-grid">
                {% for item in productos %}
                    <div class="card-producto">
                        {% if item.imagen %}
                            <img src="{{ item.imagen.url }}" alt="{{ item.nombre }}">
                        {% else %}
                            <img src="{% static 'img/default.png' %}" alt="Sin imagen">
                        {% endif %}
                        <h4>{{ item.nombre }}</h4>
                        <p class="precio">${{ item.precio }}</p>

                        <!-- üîπ Etiquetas / filtros -->
                        {% if item.etiquetas.exists %}
                        <div class="etiquetas-producto">
                            {% for etiqueta in item.etiquetas.all %}
                                <span class="etiqueta">{{ etiqueta.nombre }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- üîπ Botones de acci√≥n -->
                        <div class="acciones-producto">
                            <!-- Abrir modal detalle -->
                            <button type="button" class="btn-detalle" onclick="abrirModal('modal-detalle-{{ seccion }}-{{ item.id }}')">üëÅÔ∏è Detalle</button>

                            <!-- Editar -->
                            {% if seccion == 'vinos' %}
                                <a href="{% url 'catalogo:editar_producto' item.id %}" class="btn-editar">‚úèÔ∏è Editar</a>
                            {% else %}
                                <a href="{% url 'catalogo:editar_combo' item.id %}" class="btn-editar">‚úèÔ∏è Editar</a>
                            {% endif %}

                            <!-- Eliminar modal -->
                            <button type="button" class="btn-eliminar" onclick="abrirModal('modal-eliminar-{{ seccion }}-{{ item.id }}')">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>

                    <!-- Modal Detalle -->
                    <div id="modal-detalle-{{ seccion }}-{{ item.id }}" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="cerrarModal('modal-detalle-{{ seccion }}-{{ item.id }}')">&times;</span>
                            {% if item.imagen %}
                                <img src="{{ item.imagen.url }}" class="modal-img">
                            {% endif %}
                            <h2>{{ item.nombre }}</h2>
                            <p><strong>Precio:</strong> ${{ item.precio }}</p>
                            {% if item.descripcion %}
                                <p><strong>Descripci√≥n:</strong> {{ item.descripcion }}</p>
                            {% endif %}
                            {% if item.categoria %}
                                <p><strong>Categor√≠as:</strong> {{ item.categoria }}</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Modal Eliminar -->
                    <div id="modal-eliminar-{{ seccion }}-{{ item.id }}" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="cerrarModal('modal-eliminar-{{ seccion }}-{{ item.id }}')">&times;</span>
                            <p>¬øEst√°s seguro que deseas eliminar <strong>{{ item.nombre }}</strong>?</p>
                            <form action="{% if seccion == 'vinos' %}{% url 'catalogo:eliminar_producto' item.id %}{% else %}{% url 'catalogo:eliminar_combo' item.id %}{% endif %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" class="btn-eliminar">Eliminar</button>
                                <button type="button" class="btn-secundario" onclick="cerrarModal('modal-eliminar-{{ seccion }}-{{ item.id }}')">Cancelar</button>
                            </form>
                        </div>
                    </div>
                {% empty %}
                    <p class="no-productos">No hay {{ seccion }} registrados a√∫n.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    function filtrarProductos() {
        const buscar = document.querySelector(".input-buscar").value;
        const precioMin = document.querySelectorAll(".input-precio")[0].value;
        const precioMax = document.querySelectorAll(".input-precio")[1].value;

        const params = new URLSearchParams();
        params.append("buscar", buscar);
        params.append("precio_min", precioMin);
        params.append("precio_max", precioMax);

        const grupos = ["pais", "color", "alcohol", "uva", "vol", "fest", "prem", "reg"];
        grupos.forEach(grupo => {
            const seleccionados = Array.from(document.querySelectorAll(`input[name="${grupo}"]:checked`))
                .map(c => c.value);
            if (seleccionados.length > 0) {
                params.append(grupo, seleccionados.join(","));
            }
        });

        const url = document.querySelector("#productos-container").dataset.filtrarUrl;

        fetch(`${url}?${params.toString()}`)
            .then(response => response.text())
            .then(html => {
                document.querySelector("#productos-container").innerHTML = html;
            })
            .catch(err => console.error("Error en filtrado:", err));
    }

    // Event listeners
    document.querySelector(".input-buscar").addEventListener("input", filtrarProductos);
    document.querySelectorAll(".input-precio").forEach(input => {
        input.addEventListener("input", filtrarProductos);
    });
    document.querySelectorAll("input[type='checkbox']").forEach(chk => {
        chk.addEventListener("change", filtrarProductos);
    });
    document.querySelector(".btn-buscar").addEventListener("click", filtrarProductos);
});



    // Modal JS //
function abrirModal(id) {
    const modal = document.getElementById(id);
    if(modal) modal.style.display = 'block';
}

function cerrarModal(id) {
    const modal = document.getElementById(id);
    if(modal) modal.style.display = 'none';
}

// Cerrar modal al hacer click fuera
window.addEventListener('click', function(event) {
    if(event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
});


</script>

<!-- üé® Estilos y Modal -->
<style>
body { 
    background-color: #fdf9f6; 
    font-family: 'Poppins', sans-serif; 
    color: #3b2f2f; 
}
.inventario-container { 
    padding: 40px 60px; 
    max-width: 1400px; 
    margin: 0 auto; 
}
.mini-navbar { 
    display: flex; 
    justify-content: center; 
    gap: 60px; 
    margin-bottom: 35px; 
}
.mini-navbar a { 
    text-decoration: none; 
    color: #5a2a27; 
    font-weight: 600; 
    font-size: 1.1rem; 
    padding-bottom: 6px; 
    border-bottom: 2px solid transparent; 
    transition: all 0.3s ease; 
}
.mini-navbar a:hover { 
    border-color: #c18b5b; 
    color: #c18b5b; 
}
.mini-navbar a.activo { 
    border-color: #5a2a27; 
}
.main-content { 
    display: flex; 
    gap: 40px; 
    align-items: flex-start; 
}
.productos-section { 
    flex: 1; 
}
.btn-agregar-producto { 
    display: inline-block; 
    background-color: #5a2a27; 
    color: #fff; 
    padding: 10px 15px; 
    border-radius: 8px; 
    border: none; 
    font-weight: 600; 
    cursor: pointer; 
    margin-bottom: 25px; 
    transition: background 0.3s; 
}
.btn-agregar-producto:hover { 
    background-color: #7a3b35; 
}

.productos-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr); /* 5 productos por fila */
  gap: 25px;
  justify-items: center;
  padding-bottom: 20px;
}

/* üîπ Responsive (ajuste autom√°tico) */
@media (max-width: 1200px) {
  .productos-grid { grid-template-columns: repeat(4, 1fr); }
}

@media (max-width: 900px) {
  .productos-grid { grid-template-columns: repeat(3, 1fr); }
}

@media (max-width: 600px) {
  .productos-grid { grid-template-columns: repeat(2, 1fr); }
}

/* üîπ Tarjetas de producto */
.card-producto {
  width: 260px;
  background-color: #fff;
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid #e2dcd3;
  transition: transform 0.3s, box-shadow 0.3s;
}

.card-producto:hover { 
    transform: translateY(-4px); 
    box-shadow: 0 6px 16px rgba(0,0,0,0.1); 
}
.card-producto img { 
    width: 100%; 
    height: 190px; 
    object-fit: cover; 
}
.card-producto h4 { 
    margin: 12px 15px 5px; 
    font-size: 1.05rem; 
    color: #5a2a27; 
}
.precio { 
    margin: 0 15px 12px; 
    font-weight: bold; 
}
.etiquetas-producto { 
    margin: 0 15px 12px; 
}
.etiqueta { 
    display: inline-block; 
    background-color: #fff2e0; 
    color: #5a2a27; 
    padding: 2px 8px; 
    border-radius: 6px; 
    font-size: 0.8rem; 
    margin: 2px 2px 0 0; 
}
.acciones-producto { 
    display: flex; 
    justify-content: space-around; 
    padding: 10px; 
    border-top: 1px solid #eae0d5; 
    background-color: #fdfaf7; 
}
.acciones-producto button, .acciones-producto a { 
    border: none; 
    background: none; 
    cursor: pointer; 
    color: #5a2a27; 
    font-weight: 600; 
    transition: 0.2s; 
    text-decoration: none; 
}
.acciones-producto button:hover, .acciones-producto a:hover { 
    color: #c18b5b; 
}
.no-productos { 
    text-align: center; 
    color: #7a3b35; 
    font-style: italic; 
}

/* Modal */
.modal { 
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0; 
    top: 0; 
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.5); 
}
.modal-content { 
    background-color: #fff; 
    margin: 10% auto; 
    padding: 20px; 
    border-radius: 10px; 
    width: 300px; 
    position: relative; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
}
.close { 
    position: absolute; 
    top: 5px; 
    right: 10px; 
    color: #333; 
    font-size: 20px; 
    font-weight: bold; 
    cursor: pointer; 
}
.modal-img { 
    width: 100%; 
    border-radius: 5px; 
    margin-bottom: 10px; 
}
.btn-eliminar { 
    background-color: #c74f4f; 
    color: white; 
    padding: 8px 12px; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer; 
    margin-right: 6px; 
}
.btn-eliminar:hover { 
    background-color: #a63b3b; 
}
.btn-secundario { 
    background-color: #aaa; 
    color: white; 
    padding: 8px 12px; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer; 
}
.btn-secundario:hover { 
    background-color: #888; 
}
/* Contenedor principal flex */
.main-content {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start; /* fuerza todo a la izquierda */
    gap: 40px; 
    flex-wrap: wrap;          

}

/* Sidebar a la izquierda */
.sidebar-filtros {
    flex: 0 0 260px;  /* ancho fijo para que siempre quede a la izquierda */
    position: sticky; /* se queda visible al hacer scroll */
    top: 20px;
    height: fit-content;   
}

/* Grid de productos con 3 por fila m√°ximo */
.productos-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* m√°ximo 3 por fila */
    gap: 25px;
    flex: 1;
    justify-items: center; /* centra las tarjetas en cada columna */
}

/* Tarjetas adaptables, tama√±o fijo m√°ximo para no achicarse demasiado */
.card-producto {
    width: 260px; /* ancho deseado */
    max-width: 100%; /* no se salga de la columna */
    box-sizing: border-box;

}


</style>

{% endblock %}



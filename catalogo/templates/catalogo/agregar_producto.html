{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="form-container">
    <h2>Agregar Producto</h2>

    <form method="POST" action="{% url 'catalogo:agregar_producto' %}" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Nombre del producto -->
        <div class="form-group">
            <label for="nombre">Nombre del Producto:</label>
            <input type="text" id="nombre" name="nombre" required>
        </div>

        <!-- Precio del producto -->
        <div class="form-group">
            <label for="precio">Precio:</label>
            <input type="number" step="0.01" id="precio" name="precio" required>
        </div>

        <!-- Descripción del producto -->
        <div class="form-group">
            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" rows="3"></textarea>
        </div>

        <!-- Imagen del producto (opcional) -->
        <div class="form-group">
            <label for="imagen">Foto del Producto (opcional):</label>
            <input type="file" id="imagen" name="imagen" accept="image/*">
        </div>

        <!-- Categorías principales -->
        <div class="form-group">
            <label>Categorías principales:</label>
            {% for categoria in categorias_productos %}
                <div>
                    <input type="checkbox" class="categoria-principal" id="cat_{{ categoria.id }}" value="{{ categoria.id }}">
                    <label for="cat_{{ categoria.id }}">{{ categoria.nombre }}</label>
                </div>
            {% endfor %}
        </div>

        <!-- Subcategorías -->
        <div class="form-group">
            <label>Subcategorías:</label>
            <div id="subcategorias-container">
                <!-- JS llenará esto según categorías seleccionadas -->
            </div>
        </div>

        <!-- Botones -->
        <div class="form-group botones">
            <button type="submit" class="btn">Guardar Producto</button>
            <a href="{% url 'catalogo:admin_lista_catalogo' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<!-- Script para subcategorías dinámicas -->
{{ categorias_json|json_script:"categorias-data" }}
<script>
    const subcategoriasData = JSON.parse(document.getElementById('categorias-data').textContent);

    const catCheckboxes = document.querySelectorAll('.categoria-principal');
    const subContainer = document.getElementById('subcategorias-container');

    catCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
            subContainer.innerHTML = ''; // Limpiar subcategorías

            catCheckboxes.forEach(c => {
                if (c.checked) {
                    subcategoriasData[c.value].forEach(sub => {
                        const div = document.createElement('div');
                        div.innerHTML = `
                            <input type="checkbox" name="subcategorias" value="${sub.id}" id="sub_${sub.id}">
                            <label for="sub_${sub.id}">${sub.nombre}</label>
                        `;
                        subContainer.appendChild(div);
                    });
                }
            });
        });
    });
</script>
{% endblock %}

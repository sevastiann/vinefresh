{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="form-container">
    <h2>Agregar Subcategoría</h2>

    <form method="POST" action="{% url 'catalogo:agregar_subcategoria' %}">
        {% csrf_token %}

        <!-- Parte 1: Selección de sección -->
        <div class="form-group">
            <label for="seccion">Sección:</label>
            <select id="seccion" name="seccion" required>
                <option value="">-- Selecciona una sección --</option>
                <option value="productos">Productos</option>
                <option value="combos">Combos</option>
            </select>
        </div>

        <!-- Parte 2: Selección de categoría según la sección -->
        <div class="form-group" id="categoria-container" style="display:none;">
            <label for="categoria">Categoría:</label>
            <select id="categoria" name="categoria">
                <!-- Opciones se llenan dinámicamente con JS -->
            </select>
        </div>

        <!-- Parte 3: Nueva subcategoría -->
        <div class="form-group">
            <label for="subcategoria">Nombre de la nueva subcategoría:</label>
            <input type="text" id="subcategoria" name="subcategoria" required>
        </div>

        <button type="submit" class="btn">Guardar Subcategoría</button>
        <a href="{% url 'catalogo:admin_lista_catalogo' %}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<script>
    const seccionSelect = document.getElementById('seccion');
    const categoriaContainer = document.getElementById('categoria-container');
    const categoriaSelect = document.getElementById('categoria');

    // Categorías disponibles (esto debería venir del contexto de Django)
    const categoriasData = {
        productos: [
            {id: 1, nombre: 'Color'},
            {id: 2, nombre: 'Nivel de dulzura'},
            {id: 3, nombre: 'Cuerpo / Maridaje'},
            {id: 4, nombre: 'Crianza en barrica'},
            {id: 5, nombre: 'Variedad de uva'}
        ],
        combos: [
            {id: 101, nombre: 'Tipo de combo'},
            {id: 102, nombre: 'Tamaño / Presentación'}
        ]
    };

    seccionSelect.addEventListener('change', () => {
        const seccion = seccionSelect.value;

        if (!seccion) {
            categoriaContainer.style.display = 'none';
            categoriaSelect.innerHTML = '';
            return;
        }

        // Mostrar contenedor
        categoriaContainer.style.display = 'block';

        // Limpiar opciones
        categoriaSelect.innerHTML = '';

        // Agregar opción por defecto
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.text = '-- Selecciona una categoría --';
        categoriaSelect.add(defaultOption);

        // Agregar categorías según la sección
        categoriasData[seccion].forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.id;
            option.text = cat.nombre;
            categoriaSelect.add(option);
        });
    });
</script>
{% endblock %}

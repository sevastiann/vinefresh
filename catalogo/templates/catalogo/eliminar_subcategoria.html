<!-- üóëÔ∏è Modal Eliminar Subcategor√≠a -->
<div id="modalEliminarSubcategoria" class="modal-overlay">
    <div class="modal-content">
        <span id="cerrarModalEliminar" class="cerrar-modal">&times;</span>
        <h2>Eliminar Subcategor√≠a</h2>

        <form method="POST" action="{% url 'catalogo:eliminar_subcategoria' %}">
            {% csrf_token %}

            <!-- Nivel 1: Secci√≥n -->
            <div class="form-group">
                <label for="seccionEliminar">Secci√≥n:</label>
                <select id="seccionEliminar" name="seccion" required>
                    <option value="">-- Selecciona una secci√≥n --</option>
                    <option value="productos">Productos</option>
                    <option value="combos">Combos</option>
                </select>
            </div>

            <!-- Nivel 2: Categor√≠a principal -->
            <div class="form-group" id="categoria-principal-eliminar-container" style="display:none;">
                <label for="categoriaPrincipalEliminar">Categor√≠a principal:</label>
                <select id="categoriaPrincipalEliminar" name="categoria_principal"></select>
            </div>

            <!-- Nivel 3: Subcategor√≠a -->
            <div class="form-group" id="subcategoria-eliminar-container" style="display:none;">
                <label for="subcategoriaEliminar">Subcategor√≠a:</label>
                <select id="subcategoriaEliminar" name="subcategoria_id" required></select>
            </div>

            <div class="botones-modal">
                <button type="submit" class="btn-eliminar">Eliminar</button>
                <button type="button" id="cerrarModalEliminar2" class="btn-cancelar">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<!-- üé® Estilos -->
<style>
.modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
.modal-content {
    background: #fff;
    color: #333;
    padding: 20px 30px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    position: relative;
}
.cerrar-modal {
    position: absolute;
    top: 10px; right: 15px;
    cursor: pointer;
    font-size: 1.4em;
    color: #888;
}
.cerrar-modal:hover { color: #000; }
.btn-eliminar {
    background: #a12a2a;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
}
.btn-eliminar:hover { background: #7e1e1e; }
</style>

<!-- ‚öôÔ∏è Script -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const abrirEliminar = document.getElementById("abrirModalEliminar");
    const modalEliminar = document.getElementById("modalEliminarSubcategoria");
    const cerrarEliminar = document.getElementById("cerrarModalEliminar");
    const cerrarEliminar2 = document.getElementById("cerrarModalEliminar2");

    const seccionSelect = document.getElementById("seccionEliminar");
    const categoriaPrincipalSelect = document.getElementById("categoriaPrincipalEliminar");
    const subcategoriaSelect = document.getElementById("subcategoriaEliminar");

    const categoriaPrincipalContainer = document.getElementById("categoria-principal-eliminar-container");
    const subcategoriaContainer = document.getElementById("subcategoria-eliminar-container");

    // Mostrar / Ocultar modal
    if (abrirEliminar && modalEliminar) {
        abrirEliminar.onclick = () => modalEliminar.style.display = "flex";
        cerrarEliminar.onclick = () => modalEliminar.style.display = "none";
        cerrarEliminar2.onclick = () => modalEliminar.style.display = "none";
    }
    window.onclick = e => { if (e.target === modalEliminar) modalEliminar.style.display = "none"; };

    // üóÇÔ∏è Datos de categor√≠as principales desde el script global
    const categoriasData = window.categoriasData; // viene de <script> en base.html

    // üéØ Cuando se cambia la secci√≥n
    seccionSelect.addEventListener("change", () => {
        const seccion = seccionSelect.value;
        categoriaPrincipalSelect.innerHTML = "";
        subcategoriaSelect.innerHTML = "";
        subcategoriaContainer.style.display = "none";

        if (!seccion) {
            categoriaPrincipalContainer.style.display = "none";
            return;
        }

        categoriaPrincipalContainer.style.display = "block";

        const defaultOption = document.createElement("option");
        defaultOption.text = "-- Selecciona una categor√≠a principal --";
        defaultOption.value = "";
        categoriaPrincipalSelect.appendChild(defaultOption);

        categoriasData[seccion].forEach(([valor, texto]) => {
            const opt = document.createElement("option");
            opt.value = valor;
            opt.textContent = texto;
            categoriaPrincipalSelect.appendChild(opt);
        });
    });

    // üéØ Cargar subcategor√≠as reales (inyectadas desde Django)
    const subcategoriasData = JSON.parse('{{ subcategorias_json|escapejs }}');

    categoriaPrincipalSelect.addEventListener("change", () => {
        const seccion = seccionSelect.value;
        const categoria = categoriaPrincipalSelect.value;
        subcategoriaSelect.innerHTML = "";

        if (!categoria) {
            subcategoriaContainer.style.display = "none";
            return;
        }

        subcategoriaContainer.style.display = "block";
        const defaultOption = document.createElement("option");
        defaultOption.text = "-- Selecciona una subcategor√≠a --";
        defaultOption.value = "";
        subcategoriaSelect.appendChild(defaultOption);

        // Filtra subcategor√≠as que coinciden con la secci√≥n y la categor√≠a principal
        const filtradas = subcategoriasData.filter(s => s.seccion === seccion && s.categoria_principal === categoria);
        filtradas.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.id;
            opt.textContent = s.nombre;
            subcategoriaSelect.appendChild(opt);
        });

        if (filtradas.length === 0) {
            const noOpt = document.createElement("option");
            noOpt.text = "(No hay subcategor√≠as registradas)";
            noOpt.disabled = true;
            subcategoriaSelect.appendChild(noOpt);
        }
    });
});
</script>
